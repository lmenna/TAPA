"use strict";

require("@babel/polyfill");

var XMLHttpRequest = require("xmlhttprequest").XMLHttpRequest;

var threshold = 1.05;
var numberOfChecks = 0;
var intervalHandel = -1;
var maxBuyArb = 0;
var maxSellArb = 0;
var timeInSecondsBetweenPriceChecks = 30;

function getPricingData() {
  console.log("BEGIN: getPricingData");
  var xmlhttp = new XMLHttpRequest(),
      method = "GET",
      url = "https://poloniex.com/public?command=returnTicker";
  console.log("Loading data from : Http.send(", url, ")");
  xmlhttp.open(method, url, true);

  xmlhttp.onerror = function () {
    console.log("** An error occurred during the transaction");
  };

  xmlhttp.onreadystatechange = function () {
    if (this.readyState === 4 && this.status === 200) {
      var exchangeData = xmlhttp.responseText;
      numberOfChecks++;
      var exchangeObject = JSON.parse(exchangeData);
      analyzePrices(exchangeObject, "USDC");
      analyzePrices(exchangeObject, "USDT");

      if (numberOfChecks === 1 || numberOfChecks % 5 === 0) {
        if (intervalHandel != -1) clearInterval(intervalHandel);
        var newInteral = 1000 * (timeInSecondsBetweenPriceChecks + 20 * Math.random());
        console.log("Resetting the timer interval to ".concat(newInteral / 1000, " seconds."));
        intervalHandel = setInterval(findPricingAnomolies, newInteral);
      }
    }
  };

  xmlhttp.send();
  console.log("END: getPricingData");
}

function analyzePrices(exchangePrices, baseStableCoin) {
  var coins;
  if (baseStableCoin === "USDC") coins = ["FOAM", "ZEC", "LTC", "ETH", "XRP", "STR", "XMR", "DOGE", "BCHABC", "BCHSV"];else coins = ["BAT", "BNT", "DASH", "DOGE", "EOS", "ETC", "ETH", "GNT", "KNC", "LOOM", "LSK", "LTC", "MANA", "NXT", "QTUM", "REP", "SC", "SNT", "STR", "XMR", "XRP", "ZEC", "ZRX"];
  var timeStamp = new Date();
  var timeStampStr = timeStamp.getTime();
  console.log("priceCheckCount:".concat(numberOfChecks, "|maxBuyArb:").concat(maxBuyArb, "|maxSellArb:").concat(maxSellArb)); // Check if buying the coin will be profitable.

  coins.forEach(function (curCoin) {
    var lowestAskBTC = exchangePrices["BTC_" + curCoin].lowestAsk;
    var highestBidUSDC = exchangePrices[baseStableCoin + "_" + curCoin].highestBid;
    var USDC_BTClowestAsk = exchangePrices[baseStableCoin + "_" + "BTC"].lowestAsk;
    var ArbRatio = highestBidUSDC / (lowestAskBTC * USDC_BTClowestAsk);
    var showMax = "";

    if (ArbRatio > maxBuyArb) {
      maxBuyArb = ArbRatio;
      showMax = "NewMax";
    }

    console.log("REC|".concat(timeStamp, "|").concat(timeStampStr, "|Buy|").concat(baseStableCoin, "|").concat(curCoin, "|ArbRatio:").concat(ArbRatio, "|").concat(showMax));

    if (ArbRatio > threshold) {
      console.log("Something dramatic needs to happen!");
    }
  }); // Check if selling the coin will be profitable

  coins.forEach(function (curCoin) {
    var BTC_curCoinBid = exchangePrices["BTC_" + curCoin].highestBid;
    var USDC_BTCBid = exchangePrices[baseStableCoin + "_" + "BTC"].highestBid;
    var USDC_curCoinAsk = exchangePrices[baseStableCoin + "_" + curCoin].lowestAsk;
    var AmtInit = 10000;
    var AmtFinal = AmtInit * BTC_curCoinBid * USDC_BTCBid / USDC_curCoinAsk;
    var ArbRatio = AmtFinal / AmtInit;
    var showMax = "";

    if (ArbRatio > maxSellArb) {
      maxSellArb = ArbRatio;
      showMax = "NewMax";
    }

    console.log("REC|".concat(timeStamp, "|").concat(timeStampStr, "|Sell|").concat(baseStableCoin, "|").concat(curCoin, "|ArbRatio:").concat(ArbRatio, "|").concat(showMax));

    if (ArbRatio > threshold) {
      console.log("Something dramatic needs to happen!");
    }
  });
}
/* findPricingAnomolies
 * desc: Called periodically from setInterval.  Will check through the market pricing data and notify
 *       when any pricing anomolies are detected.
 */


function findPricingAnomolies() {
  console.log("BEGIN: findPricingAnomolies activated at:", new Date());
  getPricingData();
  console.log("END: findPricingAnomolies finished at:", new Date());
}

console.log("BEGIN: Main process to monitor prices starting at:", new Date());
console.log("Will check prices every ".concat(timeInSecondsBetweenPriceChecks, " seconds"));
getPricingData();
console.log("END: Main process to monitor prices ending at:", new Date());
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9hcHAuanMiXSwibmFtZXMiOlsicmVxdWlyZSIsIlhNTEh0dHBSZXF1ZXN0IiwidGhyZXNob2xkIiwibnVtYmVyT2ZDaGVja3MiLCJpbnRlcnZhbEhhbmRlbCIsIm1heEJ1eUFyYiIsIm1heFNlbGxBcmIiLCJ0aW1lSW5TZWNvbmRzQmV0d2VlblByaWNlQ2hlY2tzIiwiZ2V0UHJpY2luZ0RhdGEiLCJjb25zb2xlIiwibG9nIiwieG1saHR0cCIsIm1ldGhvZCIsInVybCIsIm9wZW4iLCJvbmVycm9yIiwib25yZWFkeXN0YXRlY2hhbmdlIiwicmVhZHlTdGF0ZSIsInN0YXR1cyIsImV4Y2hhbmdlRGF0YSIsInJlc3BvbnNlVGV4dCIsImV4Y2hhbmdlT2JqZWN0IiwiSlNPTiIsInBhcnNlIiwiYW5hbHl6ZVByaWNlcyIsImNsZWFySW50ZXJ2YWwiLCJuZXdJbnRlcmFsIiwiTWF0aCIsInJhbmRvbSIsInNldEludGVydmFsIiwiZmluZFByaWNpbmdBbm9tb2xpZXMiLCJzZW5kIiwiZXhjaGFuZ2VQcmljZXMiLCJiYXNlU3RhYmxlQ29pbiIsImNvaW5zIiwidGltZVN0YW1wIiwiRGF0ZSIsInRpbWVTdGFtcFN0ciIsImdldFRpbWUiLCJmb3JFYWNoIiwiY3VyQ29pbiIsImxvd2VzdEFza0JUQyIsImxvd2VzdEFzayIsImhpZ2hlc3RCaWRVU0RDIiwiaGlnaGVzdEJpZCIsIlVTRENfQlRDbG93ZXN0QXNrIiwiQXJiUmF0aW8iLCJzaG93TWF4IiwiQlRDX2N1ckNvaW5CaWQiLCJVU0RDX0JUQ0JpZCIsIlVTRENfY3VyQ29pbkFzayIsIkFtdEluaXQiLCJBbXRGaW5hbCJdLCJtYXBwaW5ncyI6Ijs7QUFBQUEsT0FBTyxDQUFDLGlCQUFELENBQVA7O0FBRUEsSUFBSUMsY0FBYyxHQUFHRCxPQUFPLENBQUMsZ0JBQUQsQ0FBUCxDQUEwQkMsY0FBL0M7O0FBQ0EsSUFBSUMsU0FBUyxHQUFHLElBQWhCO0FBQ0EsSUFBSUMsY0FBYyxHQUFHLENBQXJCO0FBQ0Es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QUFPLENBQUNDLEdBQVIsQ0FBWSxnREFBWixFQUE4RCxJQUFJMEIsSUFBSixFQUE5RCIsInNvdXJjZXNDb250ZW50IjpbInJlcXVpcmUoXCJAYmFiZWwvcG9seWZpbGxcIik7XG5cbnZhciBYTUxIdHRwUmVxdWVzdCA9IHJlcXVpcmUoXCJ4bWxodHRwcmVxdWVzdFwiKS5YTUxIdHRwUmVxdWVzdDtcbnZhciB0aHJlc2hvbGQgPSAxLjA1O1xudmFyIG51bWJlck9mQ2hlY2tzID0gMDtcbnZhciBpbnRlcnZhbEhhbmRlbCA9IC0xO1xudmFyIG1heEJ1eUFyYiA9IDA7XG52YXIgbWF4U2VsbEFyYiA9IDA7XG5cbmNvbnN0IHRpbWVJblNlY29uZHNCZXR3ZWVuUHJpY2VDaGVja3MgPSAzMDtcblxuZnVuY3Rpb24gZ2V0UHJpY2luZ0RhdGEoKSB7XG5cbiAgY29uc29sZS5sb2coXCJCRUdJTjogZ2V0UHJpY2luZ0RhdGFcIik7XG4gIHZhciB4bWxodHRwID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCksXG4gICAgbWV0aG9kID0gXCJHRVRcIixcbiAgICB1cmwgPSBcImh0dHBzOi8vcG9sb25pZXguY29tL3B1YmxpYz9jb21tYW5kPXJldHVyblRpY2tlclwiO1xuXG4gIGNvbnNvbGUubG9nKFwiTG9hZGluZyBkYXRhIGZyb20gOiBIdHRwLnNlbmQoXCIsIHVybCwgXCIpXCIpO1xuICB4bWxodHRwLm9wZW4obWV0aG9kLCB1cmwsIHRydWUpO1xuICB4bWxodHRwLm9uZXJyb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgY29uc29sZS5sb2coXCIqKiBBbiBlcnJvciBvY2N1cnJlZCBkdXJpbmcgdGhlIHRyYW5zYWN0aW9uXCIpO1xuICB9O1xuICB4bWxodHRwLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLnJlYWR5U3RhdGU9PT00ICYmIHRoaXMuc3RhdHVzPT09MjAwKSB7XG4gICAgICBsZXQgZXhjaGFuZ2VEYXRhID0geG1saHR0cC5yZXNwb25zZVRleHQ7XG4gICAgICBudW1iZXJPZkNoZWNrcysrO1xuICAgICAgbGV0IGV4Y2hhbmdlT2JqZWN0ID0gSlNPTi5wYXJzZShleGNoYW5nZURhdGEpO1xuICAgICAgYW5hbHl6ZVByaWNlcyhleGNoYW5nZU9iamVjdCwgXCJVU0RDXCIpO1xuICAgICAgYW5hbHl6ZVByaWNlcyhleGNoYW5nZU9iamVjdCwgXCJVU0RUXCIpO1xuICAgICAgaWYgKG51bWJlck9mQ2hlY2tzPT09MSB8fCBudW1iZXJPZkNoZWNrcyU1PT09MCkge1xuICAgICAgICBpZiAoaW50ZXJ2YWxIYW5kZWwhPS0xKVxuICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWxIYW5kZWwpO1xuICAgICAgICBsZXQgbmV3SW50ZXJhbCA9IDEwMDAqKHRpbWVJblNlY29uZHNCZXR3ZWVuUHJpY2VDaGVja3MgKyAyMCpNYXRoLnJhbmRvbSgpKTtcbiAgICAgICAgY29uc29sZS5sb2coYFJlc2V0dGluZyB0aGUgdGltZXIgaW50ZXJ2YWwgdG8gJHtuZXdJbnRlcmFsLzEwMDB9IHNlY29uZHMuYCApO1xuICAgICAgICBpbnRlcnZhbEhhbmRlbCA9IHNldEludGVydmFsKCBmaW5kUHJpY2luZ0Fub21vbGllcywgIG5ld0ludGVyYWwpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICB4bWxodHRwLnNlbmQoKTtcbiAgY29uc29sZS5sb2coXCJFTkQ6IGdldFByaWNpbmdEYXRhXCIpO1xufVxuXG5mdW5jdGlvbiBhbmFseXplUHJpY2VzKGV4Y2hhbmdlUHJpY2VzLCBiYXNlU3RhYmxlQ29pbikge1xuXG4gIHZhciBjb2lucztcbiAgaWYgKGJhc2VTdGFibGVDb2luPT09XCJVU0RDXCIpIFxuICAgIGNvaW5zID0gW1wiRk9BTVwiLCBcIlpFQ1wiLCBcIkxUQ1wiLCBcIkVUSFwiLCBcIlhSUFwiLCBcIlNUUlwiLCBcIlhNUlwiLCBcIkRPR0VcIiwgXCJCQ0hBQkNcIiwgXCJCQ0hTVlwiXTtcbiAgZWxzZVxuICAgIGNvaW5zID0gW1wiQkFUXCIsIFwiQk5UXCIsIFwiREFTSFwiLCBcIkRPR0VcIiwgXCJFT1NcIiwgXCJFVENcIiwgXCJFVEhcIiwgXCJHTlRcIiwgXCJLTkNcIiwgXCJMT09NXCIsIFwiTFNLXCIsXG4gICAgICBcIkxUQ1wiLCBcIk1BTkFcIiwgXCJOWFRcIiwgXCJRVFVNXCIsIFwiUkVQXCIsIFwiU0NcIiwgXCJTTlRcIiwgXCJTVFJcIiwgXCJYTVJcIiwgXCJYUlBcIiwgXCJaRUNcIiwgXCJaUlhcIl07XG5cbiAgbGV0IHRpbWVTdGFtcCA9IG5ldyBEYXRlKCk7XG4gIGxldCB0aW1lU3RhbXBTdHIgPSB0aW1lU3RhbXAuZ2V0VGltZSgpO1xuICBcbiAgY29uc29sZS5sb2coYHByaWNlQ2hlY2tDb3VudDoke251bWJlck9mQ2hlY2tzfXxtYXhCdXlBcmI6JHttYXhCdXlBcmJ9fG1heFNlbGxBcmI6JHttYXhTZWxsQXJifWApO1xuICAvLyBDaGVjayBpZiBidXlpbmcgdGhlIGNvaW4gd2lsbCBiZSBwcm9maXRhYmxlLlxuICBjb2lucy5mb3JFYWNoKGN1ckNvaW4gPT4ge1xuICAgIGxldCBsb3dlc3RBc2tCVEMgPSBleGNoYW5nZVByaWNlc1tcIkJUQ19cIiArIGN1ckNvaW5dLmxvd2VzdEFzaztcbiAgICBsZXQgaGlnaGVzdEJpZFVTREMgPSBleGNoYW5nZVByaWNlc1tiYXNlU3RhYmxlQ29pbiArIFwiX1wiICsgY3VyQ29pbl0uaGlnaGVzdEJpZDtcbiAgICBsZXQgVVNEQ19CVENsb3dlc3RBc2sgPSBleGNoYW5nZVByaWNlc1tiYXNlU3RhYmxlQ29pbiArIFwiX1wiICsgXCJCVENcIl0ubG93ZXN0QXNrO1xuICAgIGxldCBBcmJSYXRpbyA9IGhpZ2hlc3RCaWRVU0RDIC8gKCBsb3dlc3RBc2tCVEMgKiAgVVNEQ19CVENsb3dlc3RBc2spO1xuICAgIGxldCBzaG93TWF4ID0gXCJcIjtcbiAgICBpZiAoQXJiUmF0aW8+bWF4QnV5QXJiKSB7XG4gICAgICBtYXhCdXlBcmIgPSBBcmJSYXRpbztcbiAgICAgIHNob3dNYXggPSBcIk5ld01heFwiO1xuICAgIH1cbiAgICBjb25zb2xlLmxvZyhgUkVDfCR7dGltZVN0YW1wfXwke3RpbWVTdGFtcFN0cn18QnV5fCR7YmFzZVN0YWJsZUNvaW59fCR7Y3VyQ29pbn18QXJiUmF0aW86JHtBcmJSYXRpb318JHtzaG93TWF4fWApO1xuICAgIGlmIChBcmJSYXRpbyA+IHRocmVzaG9sZCkge1xuICAgICAgY29uc29sZS5sb2coXCJTb21ldGhpbmcgZHJhbWF0aWMgbmVlZHMgdG8gaGFwcGVuIVwiKTtcbiAgICB9XG4gIH0pO1xuICAvLyBDaGVjayBpZiBzZWxsaW5nIHRoZSBjb2luIHdpbGwgYmUgcHJvZml0YWJsZVxuICBjb2lucy5mb3JFYWNoKGN1ckNvaW4gPT4ge1xuICAgIGxldCBCVENfY3VyQ29pbkJpZCA9IGV4Y2hhbmdlUHJpY2VzW1wiQlRDX1wiK2N1ckNvaW5dLmhpZ2hlc3RCaWQ7XG4gICAgbGV0IFVTRENfQlRDQmlkID0gZXhjaGFuZ2VQcmljZXNbYmFzZVN0YWJsZUNvaW4gKyBcIl9cIiArIFwiQlRDXCJdLmhpZ2hlc3RCaWQ7XG4gICAgbGV0IFVTRENfY3VyQ29pbkFzayA9IGV4Y2hhbmdlUHJpY2VzW2Jhc2VTdGFibGVDb2luICsgXCJfXCIgK2N1ckNvaW5dLmxvd2VzdEFzaztcbiAgICBsZXQgQW10SW5pdCA9IDEwMDAwO1xuICAgIGxldCBBbXRGaW5hbCA9IEFtdEluaXQqQlRDX2N1ckNvaW5CaWQqVVNEQ19CVENCaWQvVVNEQ19jdXJDb2luQXNrO1xuICAgIGxldCBBcmJSYXRpbyA9IEFtdEZpbmFsL0FtdEluaXQ7XG4gICAgbGV0IHNob3dNYXggPSBcIlwiO1xuICAgIGlmIChBcmJSYXRpbz5tYXhTZWxsQXJiKSB7XG4gICAgICBtYXhTZWxsQXJiID0gQXJiUmF0aW87XG4gICAgICBzaG93TWF4ID0gXCJOZXdNYXhcIjtcbiAgICB9XG4gICAgY29uc29sZS5sb2coYFJFQ3wke3RpbWVTdGFtcH18JHt0aW1lU3RhbXBTdHJ9fFNlbGx8JHtiYXNlU3RhYmxlQ29pbn18JHtjdXJDb2lufXxBcmJSYXRpbzoke0FyYlJhdGlvfXwke3Nob3dNYXh9YCk7XG4gICAgaWYgKEFyYlJhdGlvID4gdGhyZXNob2xkKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIlNvbWV0aGluZyBkcmFtYXRpYyBuZWVkcyB0byBoYXBwZW4hXCIpO1xuICAgIH1cbiAgfSk7XG59XG5cblxuLyogZmluZFByaWNpbmdBbm9tb2xpZXNcbiAqIGRlc2M6IENhbGxlZCBwZXJpb2RpY2FsbHkgZnJvbSBzZXRJbnRlcnZhbC4gIFdpbGwgY2hlY2sgdGhyb3VnaCB0aGUgbWFya2V0IHByaWNpbmcgZGF0YSBhbmQgbm90aWZ5XG4gKiAgICAgICB3aGVuIGFueSBwcmljaW5nIGFub21vbGllcyBhcmUgZGV0ZWN0ZWQuXG4gKi9cbmZ1bmN0aW9uIGZpbmRQcmljaW5nQW5vbW9saWVzKCkge1xuXG4gIGNvbnNvbGUubG9nKFwiQkVHSU46IGZpbmRQcmljaW5nQW5vbW9saWVzIGFjdGl2YXRlZCBhdDpcIiwgbmV3IERhdGUoKSk7XG4gIGdldFByaWNpbmdEYXRhKCk7XG4gIGNvbnNvbGUubG9nKFwiRU5EOiBmaW5kUHJpY2luZ0Fub21vbGllcyBmaW5pc2hlZCBhdDpcIiwgbmV3IERhdGUoKSk7XG59XG5cbmNvbnNvbGUubG9nKFwiQkVHSU46IE1haW4gcHJvY2VzcyB0byBtb25pdG9yIHByaWNlcyBzdGFydGluZyBhdDpcIiwgbmV3IERhdGUoKSk7XG5jb25zb2xlLmxvZyhgV2lsbCBjaGVjayBwcmljZXMgZXZlcnkgJHt0aW1lSW5TZWNvbmRzQmV0d2VlblByaWNlQ2hlY2tzfSBzZWNvbmRzYCApO1xuZ2V0UHJpY2luZ0RhdGEoKTtcbmNvbnNvbGUubG9nKFwiRU5EOiBNYWluIHByb2Nlc3MgdG8gbW9uaXRvciBwcmljZXMgZW5kaW5nIGF0OlwiLCBuZXcgRGF0ZSgpKTtcbiJdfQ==